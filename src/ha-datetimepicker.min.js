// HA-PopOver v1.0 � 2016 by Hossein Alipour http://hosseinalipour.ir
function HaDateTimePicker(e,t){this.solarDate=new HaSolarDate,this.target=e,t=t||{};var a=!!t.isSolar&&"true"===t.isSolar.toString().toLowerCase();this.options={date:t.date||new Date,isSolar:a,maxYear:t.maxYear||a===!0?1450:2050,minYear:t.minYear||a===!0?1350:1950,pagingDuration:t.pagingDuration||600,selectedDate:t.selectedDate||null,forceSetTime:!!t.forceSetTime&&"true"===t.forceSetTime.toString().toLowerCase(),resultInSolar:!!t.resultInSolar&&"true"===t.resultInSolar.toString().toLowerCase(),disableTime:!!t.disableTime&&"true"===t.disableTime.toString().toLowerCase()},this.options.isSolar===!0?(this.days=this.solarDate.dayNames,this.monthNames=this.solarDate.monthNames,this.renderedDate=this.solarDate.convertFromGregorian(this.options.date),null!=this.options.selectedDate&&(this.selectedDate=this.options.resultInSolar===!1?this.solarDate.convertFromGregorian(this.options.selectedDate):this.options.selectedDate)):(this.renderedDate=this.options.date,null!=this.options.selectedDate&&(this.selectedDate=this.options.resultInSolar===!1?this.options.selectedDate:this.solarDate.convertToGregorian(new HaSolarDate(this.options.selectedDate.getFullYear(),this.options.selectedDate.getMonth(),this.options.selectedDate.getDate()))),this.days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"]),null!=this.selectedDate&&(this.selectedTime={hour:this.selectedDate.getHours()>=12?this.selectedDate.getHours()-12:this.selectedDate.getHours(),minute:this.selectedDate.getMinutes(),amOrPm:this.selectedDate.getHours()>=12?"pm":"am"}),this.options.disableTime===!0&&(this.options.forceSetTime=!1,this.selectedTime=null)}function twoDigits(e){return e.toString().length<2&&(e="0"+e.toString()),e}function createFragment(e){var t=document.createDocumentFragment(),a=document.createElement("div");for(a.innerHTML=e;a.firstChild;)t.appendChild(a.firstChild);return t}function getMonthLastDay(e,t){new Date;e+1>11&&t++;var a=new Date(t,e+1,0).getDate();return a}HaDateTimePicker.prototype.init=function(){document.querySelectorAll(".ha-datetimepicker").length>0&&document.body.removeChild(document.querySelector(".ha-datetimepicker")),this.createCalendar(),this.setupStyles(),this.renderDate(this.selectedDate||this.renderedDate),this.renderClock(),null!=this.selectedTime&&(this.renderHourHand(),this.renderMinuteHand()),this.addEvents(),this.renderResult()},HaDateTimePicker.prototype.createCalendar=function(){for(var e=1==this.options.isSolar?this.renderedDate.getFullYear().toString().toFaDigit():this.renderedDate.getFullYear(),t="<div class='ha-datetimepicker'><div class='ha-datetimepicker-container'><div class='ha-dp-header'><div class='ha-dp-year'><div class='ha-dp-year-dropdown-container'><button type='button' class='ha-dp-year-btn'>"+e+"</button><ul class='ha-dp-year-dropdown'>",a=this.options.minYear;a<=this.options.maxYear;a++){a%10==0&&(t+="<hr class='ha-dp-list-separator'/>");var r=1==this.options.isSolar?a.toString().toFaDigit():a;t+="<li class='ha-dp-year-item' data-year='"+a+"'>"+r+"</li>"}t+="</ul></div></div><div class='ha-dp-month'><button type='button' class='ha-dp-prev-btn'><</button><div class='ha-dp-month-dropdown-container'><button type='button' class='ha-dp-month-btn'>"+this.monthNames[this.renderedDate.getMonth()]+"</button><ul class='ha-dp-month-dropdown'>";for(var o=0;o<this.monthNames.length;o++)t+="<li class='ha-dp-month-item'>"+this.monthNames[o]+"</li>";t+="</ul></div><button type='button' class='ha-dp-next-btn'>></button></div></div>",t+="<div class='ha-dp-body'>",t+="<div>";for(var s=0;s<7;s++){var i=this.options.isSolar?this.days[s][0]:this.days[s];t+="<p class='ha-dp-cell ha-dp-cell-header'>"+i}t+="</div>",t+="<div class='ha-dp-days-container'></div>",t+="</div>",this.options.disableTime===!1&&(t+="<div class='ha-dp-clock'><div class='ha-dp-clock-header'><div class='ha-dp-ampm'><div type='button' class='ha-dp-clock-am-btn"+(this.selectedTime&&"am"==this.selectedTime.amOrPm.toLowerCase()||!this.selectedTime?" selected":"")+"'>AM</div><button type='button' class='ha-dp-clock-ampm-btn"+(this.selectedTime&&"pm"==this.selectedTime.amOrPm.toLowerCase()?" pm":" am")+"'>AMPM</button><div type='button' class='ha-dp-clock-pm-btn"+(this.selectedTime&&"pm"==this.selectedTime.amOrPm.toLowerCase()?" selected":"")+"'>PM</div></div></div><div class='ha-dp-clock-face'><div class='hours-clock-face'></div></div><p class='ha-dp-clock-res'></p><button type='button' class='ha-dp-btn ha-dp-clock-ok-btn'>OK</button></div>"),t+="<div class='ha-dp-footer'><p class='ha-dp-result'>-</p><div class='ha-dp-buttons'><button type='button' class='ha-dp-btn ha-dp-cancel-btn'>Cancel</button><button type='button' class='ha-dp-btn ha-dp-ok-btn'>OK</button>",this.options.disableTime===!1&&(t+="<button type='button' class='ha-dp-btn ha-dp-clock-btn'>Clock</button>"),t+="</div></div>",t+="</div></div>";var n=createFragment(t);document.body.insertBefore(n,document.body.childNodes[document.body.childNodes.length-1])},HaDateTimePicker.prototype.setupStyles=function(){var e=document.querySelector(".ha-dp-days-container");if(e.setAttribute("style","animation-duration:"+this.options.pagingDuration+"ms"),this.options.isSolar){var t=document.querySelector(".ha-dp-body");t.style.direction="rtl"}},HaDateTimePicker.prototype.renderDate=function(e){this.renderedDate=e;for(var t=[{daysOfWeek:[]}],a=document.querySelector(".ha-datetimepicker"),r=0;r<a.classList.length;r++)a.classList[r].indexOf("month")>=0&&a.classList.remove(a.classList[r]);a.className+=" month"+e.getMonth();var o,s;1==this.options.isSolar?(s=new HaSolarDate(e.getFullYear(),e.getMonth(),1),o=new HaSolarDate):(s=new Date(e.getFullYear(),e.getMonth(),1),o=new Date);for(var r=-s.getDay()+1,i=1;i<=6;i++){for(var n=new Array,l=1;l<=7;l++)n.push(r++);t.push({daysOfWeek:n})}var c=document.querySelector(".ha-dp-year-btn");c.innerHTML=1==this.options.isSolar?e.getFullYear().toString().toFaDigit():e.getFullYear();for(var d=document.getElementsByClassName("ha-dp-year-item"),h=0;h<d.length;h++)d[h].classList.contains("selected")&&d[h].classList.remove("selected");var u=document.querySelector(".ha-dp-year-item[data-year='"+e.getFullYear()+"']");null!=u&&(u.className+=" selected");var m=document.querySelector(".ha-dp-month-btn");m.innerHTML=this.monthNames[e.getMonth()];var p=document.querySelector(".ha-dp-days-container"),g=getMonthLastDay(e.getMonth(),e.getFullYear());g=this.solarDate.getMonthTotalDays(e.getMonth(),e.getFullYear());var D=getMonthLastDay(e.getMonth()-1,e.getFullYear());D=this.solarDate.getMonthTotalDays(e.getMonth()-1,e.getFullYear());for(var v="",y=0;y<t.length;y++){for(var f="<div>",b=0;b<t[y].daysOfWeek.length;b++){var k=t[y].daysOfWeek[b];if(k<=g&&k>0){var S,T=null!=this.selectedDate&&this.selectedDate.getFullYear()==e.getFullYear()&&this.selectedDate.getMonth()==e.getMonth()&&this.selectedDate.getDate()==k?" ha-dp-cell-selected":"",w=o.getFullYear()==e.getFullYear()&&o.getMonth()==e.getMonth()&&o.getDate()==k?" ha-dp-cell-currentdate":"";S=this.options.isSolar?6==b?" ha-dp-cell-holiday":"":5==b?" ha-dp-cell-holiday":"";var N=1==this.options.isSolar?k.toString().toFaDigit():k;f+="<p class='ha-dp-cell"+S+w+T+"' data-date='"+k+"' data-disp='"+N+"'>"+N+"</p>"}else if(k<1){var N=1==this.options.isSolar?(D+k).toString().toFaDigit():D+k;f+="<p class='ha-dp-cell ha-dp-cell-muted' data-date='"+(D+k)+"'>"+N+"</p>"}else{var N=1==this.options.isSolar?(k-g).toString().toFaDigit():k-g;f+="<p class='ha-dp-cell ha-dp-cell-muted' data-date='"+(k-g)+"'>"+N+"</p>"}}f+="</div>",v+=f}p.innerHTML=v,this.addEvents()},HaDateTimePicker.prototype.changeDate=function(e){var t=document.querySelector(".ha-dp-days-container"),a=this.options.pagingDuration;t.className=t.className.replace("page-left","").replace("page-right","").trim(),this.solarDate.compare(e,this.renderedDate)==-1?t.className+=" page-left":t.className+=" page-right";var r=this;setTimeout(function(){r.renderDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()))},a/2),setTimeout(function(){t.className=t.className.replace("page-left","").replace("page-right","").trim()},a)},HaDateTimePicker.prototype.addEvents=function(){for(var e=(document.querySelector(".ha-dp-days-container"),new Date),t=this,a=document.querySelectorAll(".ha-dp-cell:not(.ha-dp-cell-muted):not(.ha-dp-cell-header)"),r=0;r<a.length;r++)a[r].onclick=function(){for(var e=0;e<a.length;e++)a[e].className=a[e].className.replace(" ha-dp-cell-selected","");this.className+=" ha-dp-cell-selected",t.options.isSolar?t.selectedDate=new HaSolarDate(t.renderedDate.getFullYear(),t.renderedDate.getMonth(),parseInt(this.getAttribute("data-date"))):t.selectedDate=new Date(t.renderedDate.getFullYear(),t.renderedDate.getMonth(),parseInt(this.getAttribute("data-date"))),t.renderResult()};var o=document.querySelector(".ha-dp-next-btn"),s=document.querySelector(".ha-dp-prev-btn"),i=this.renderedDate.getFullYear();o.onclick=function(){var a=t.renderedDate.getMonth()+1;a>=12&&(i++,a=0),t.changeDate(new Date(i,a,e.getDate()))},s.onclick=function(){var a=t.renderedDate.getMonth()-1;a<0&&(i--,a=11),t.changeDate(new Date(i,a,e.getDate()))};var n=document.querySelector(".ha-dp-month-btn"),l=document.querySelector(".ha-dp-year-btn"),c=document.querySelector(".ha-dp-month-dropdown"),d=document.querySelector(".ha-dp-year-dropdown");document.querySelector("body").addEventListener("click",function(){c.className.indexOf("show")>-1&&(c.className=c.className.replace("show","").trim()),d.className.indexOf("show")>-1&&(d.className=d.className.replace("show","").trim())}),n.onclick=function(e){e.stopPropagation(),d.className.indexOf("show")>-1&&(d.className=d.className.replace("show","").trim()),c.className.indexOf("show")>-1?c.className=c.className.replace("show","").trim():c.className+=" show"},l.onclick=function(e){e.stopPropagation(),c.className.indexOf("show")>-1&&(c.className=c.className.replace("show","").trim()),d.className.indexOf("show")>-1?d.className=d.className.replace("show","").trim():d.className+=" show";var t=document.querySelector(".ha-dp-year-item.selected");if(null!=t){var a=Math.max(t.getAttribute("data-year")-5,document.querySelector(".ha-dp-year-item").getAttribute("data-year"));t=document.querySelector(".ha-dp-year-item[data-year='"+a+"']"),t.scrollIntoView()}};for(var h=document.querySelectorAll(".ha-dp-month-item"),u=0;u<h.length;u++)h[u].index=u,h[u].onclick=function(){if(this.index!=t.renderedDate.getMonth()){var a=this.index;t.changeDate(new Date(i,a,e.getDate()))}};for(var m=document.querySelectorAll(".ha-dp-year-item"),p=0;p<m.length;p++)m[p].onclick=function(){var a=this.getAttribute("data-year");a!=t.renderedDate.getFullYear()&&t.changeDate(new Date(a,t.renderedDate.getMonth(),e.getDate()))};var g=document.querySelector(".ha-dp-ok-btn");g.onclick=function(){null!=t.returnResults()&&t.hide()};var D=document.querySelector(".ha-dp-cancel-btn");if(D.onclick=function(){t.hide()},this.options.disableTime===!1){var v=document.querySelector(".ha-dp-clock-btn");v.onclick=function(){t.toggleClock()};var y=document.querySelector(".ha-dp-clock-am-btn"),f=document.querySelector(".ha-dp-clock-pm-btn");y.onclick=function(){t.changeAmPm("am")},f.onclick=function(){t.changeAmPm("pm")};var b=document.querySelector(".ha-dp-clock-ampm-btn");b.onclick=function(){t.changeAmPm()};var k=document.querySelector(".ha-dp-clock-ok-btn");k.onclick=function(){t.toggleClock()};for(var S=document.querySelectorAll(".ha-dp-clock-num.ha-dp-hour-num .num"),T=0;T<S.length;T++)S[T].onclick=function(){var e=this.getAttribute("data-hour");t.selectedTime||(t.selectedTime={hour:0,minute:0,amOrPm:"AM"}),t.selectedTime.hour=e,t.renderHourHand(),t.renderMinuteHand()};for(var w=document.querySelectorAll(".ha-dp-clock-num.ha-dp-minute-num .num"),T=0;T<w.length;T++)w[T].onclick=function(){var e=this.getAttribute("data-minute");t.selectedTime||(t.selectedTime={hour:0,minute:0,amOrPm:"AM"}),t.selectedTime.minute=e,t.renderMinuteHand(),t.renderHourHand()}}},HaDateTimePicker.prototype.toggleClock=function(){if(this.options.disableTime!==!0){var e=document.querySelector(".ha-datetimepicker");this.clock?e.className=e.className.replace("clock","").trim():e.className+=" clock",this.clock=!this.clock,this.renderResult()}},HaDateTimePicker.prototype.renderResult=function(){var e=document.querySelector(".ha-dp-result"),t="";null!=this.selectedDate&&(t=this.options.isSolar?this.selectedDate.getDate()+"/"+(this.selectedDate.getMonth()+1)+"/"+this.selectedDate.getFullYear():this.selectedDate.getMonth()+1+"/"+this.selectedDate.getDate()+"/"+this.selectedDate.getFullYear()),null!=this.selectedTime&&(t+=" "+twoDigits(this.getHour())+":"+twoDigits(this.getMinute())+" "+this.getAmOrPm().toUpperCase()),e.innerHTML=""==t?"-":0==this.options.isSolar?t:t.toFaDigit()},HaDateTimePicker.prototype.renderHourHand=function(){if(this.options.disableTime!==!0){for(var e=this.selectedTime.hour,t=document.querySelector(".hours-clock-face"),a=document.querySelector(".ha-dp-clock-hour-hand"),r=document.querySelectorAll(".ha-dp-clock-num.ha-dp-hour-num .num.selected"),o=0;o<r.length;o++)r[o].classList.remove("selected");document.querySelector(".ha-datetimepicker [data-hour='"+this.selectedTime.hour+"']").className+=" selected";var s;s=null!=a?a:document.createElement("div"),s.className="ha-dp-clock-hour-hand";var i=180+30*e+.5*this.selectedTime.minute;s.setAttribute("style","-webkit-transform: rotateZ("+i+"deg);-moz-transform: rotateZ("+i+"deg);transform: rotateZ("+i+"deg);"),null==a&&t.appendChild(s),this.renderClockResult()}},HaDateTimePicker.prototype.renderMinuteHand=function(){if(this.options.disableTime!==!0){for(var e=this.selectedTime.minute,t=document.querySelectorAll(".ha-dp-clock-num.ha-dp-minute-num .num.selected"),a=0;a<t.length;a++)t[a].classList.remove("selected");document.querySelector(".ha-datetimepicker [data-minute='"+this.selectedTime.minute+"']").className+=" selected";var r,o=document.querySelector(".ha-dp-clock-face"),s=document.querySelector(".ha-dp-clock-minute-hand");r=null!=s?s:document.createElement("div"),r.className="ha-dp-clock-minute-hand";var i=180+6*e;r.setAttribute("style","-webkit-transform: rotateZ("+i+"deg);-moz-transform: rotateZ("+i+"deg);transform: rotateZ("+i+"deg);"),null==s&&o.appendChild(r),this.renderClockResult()}},HaDateTimePicker.prototype.renderClockResult=function(){if(this.options.disableTime!==!0){var e=document.querySelector(".ha-dp-clock-res");e.innerHTML=twoDigits(this.getHour())+":"+twoDigits(this.getMinute())+" "+this.getAmOrPm().toUpperCase()}},HaDateTimePicker.prototype.changeAmPm=function(e){if(this.options.disableTime!==!0&&null!=this.selectedTime){var t=document.querySelector(".ha-dp-clock-ampm-btn"),a=document.querySelector(".ha-dp-clock-am-btn"),r=document.querySelector(".ha-dp-clock-pm-btn");(null==e||"am"!=e.toLowerCase()&&"pm"!=e.toLowerCase())&&(e=null==this.selectedTime?"am":"am"===this.selectedTime.amOrPm.toLowerCase()?"pm":"am"),this.selectedTime.amOrPm=e,"am"==e.toLowerCase()?(r.classList.remove("selected"),a.classList.add("selected")):(a.classList.remove("selected"),r.classList.add("selected")),t.classList.remove("am"),t.classList.remove("pm"),t.classList.add(e),this.renderClockResult()}},HaDateTimePicker.prototype.getHour=function(){var e=this.selectedTime.hour;return"pm"==this.selectedTime.amOrPm.toLowerCase()&&0==e&&(e=12),e},HaDateTimePicker.prototype.getMinute=function(){return this.selectedTime.minute},HaDateTimePicker.prototype.getAmOrPm=function(){return this.selectedTime.amOrPm},HaDateTimePicker.prototype.renderClock=function(){if(this.options.disableTime!==!0){for(var e=document.querySelector(".ha-dp-clock-face"),t=document.querySelector(".hours-clock-face"),a=0;a<12;a++){var r=document.createElement("div");r.className="ha-dp-clock-num ha-dp-hour-num";var o=document.createElement("span");o.setAttribute("data-hour",a),o.className="num",o.innerHTML=0==a?12:a,r.appendChild(o);var s=180+30*a;r.setAttribute("style","-webkit-transform: rotateZ("+s+"deg);-moz-transform: rotateZ("+s+"deg);transform: rotateZ("+s+"deg);"),o.setAttribute("style","-webkit-transform: rotateZ("+-s+"deg);-moz-transform: rotateZ("+-s+"deg);transform: rotateZ("+-s+"deg);"),t.appendChild(r)}for(var i=0;i<60;i++){var r=document.createElement("div");r.className="ha-dp-clock-num ha-dp-minute-num";var o=document.createElement("span");o.setAttribute("data-minute",i),o.className="num",o.innerHTML=i%5==0?0==i||5==i?"0"+i:i:"•",o.className+=i%5!=0?" dot":"",r.appendChild(o);var s=180+6*i;r.setAttribute("style","-webkit-transform: rotateZ("+s+"deg);-moz-transform: rotateZ("+s+"deg);transform: rotateZ("+s+"deg);"),o.setAttribute("style","-webkit-transform: rotateZ("+-s+"deg);-moz-transform: rotateZ("+-s+"deg);transform: rotateZ("+-s+"deg);"),e.appendChild(r)}}},HaDateTimePicker.prototype.returnResults=function(){if(null==this.selectedDate)return null;if(this.options.forceSetTime&&!this.selectedTime)return this.toggleClock(),null;var e=document.querySelectorAll(this.target),t="",a=this.selectedDate;!this.options.resultInSolar&&this.options.isSolar&&(a=this.solarDate.convertToGregorian(new HaSolarDate(this.selectedDate.getFullYear(),this.selectedDate.getMonth(),this.selectedDate.getDate()))),!this.options.isSolar&&this.options.resultInSolar&&(a=this.solarDate.convertFromGregorian(new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth(),this.selectedDate.getDate()))),t=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear(),null!=this.selectedTime&&(t+=" "+twoDigits(this.getHour())+":"+twoDigits(this.getMinute())+" "+this.getAmOrPm().toUpperCase());for(var r=0;r<e.length;r++){var o=e[r];"input"==o.tagName.toLowerCase()?o.value=t:o.innerHTML=t}return t},HaDateTimePicker.prototype.show=function(){this.init(),setTimeout(function(){document.querySelector(".ha-datetimepicker").className+=" show"},10)},HaDateTimePicker.prototype.hide=function(){var e=document.querySelector(".ha-datetimepicker");e.className=e.className.replace("show","").trim()},HaDateTimePicker.init=function(){for(var e=document.querySelectorAll("[data-ha-datetimepicker]"),t=0;t<e.length;t++)e[t].addEventListener("mousedown",function(){this.blur()}),e[t].addEventListener("keydown",function(e){return e.preventDefault(),!1}),e[t].addEventListener("click",function(e){this.blur();var t=new HaDateTimePicker(this.getAttribute("data-ha-datetimepicker"),{date:this.getAttribute("data-ha-dp-date"),selectedDate:this.value&&"NaN"!==Date.parse(this.value).toString()?new Date(this.value):this.innerHTML&&"NaN"!==Date.parse(this.innerHTML).toString()?new Date(this.innerHTML):this.getAttribute("data-ha-dp-selecteddate"),pagingDuration:this.getAttribute("data-ha-dp-pagingduration"),minYear:this.getAttribute("data-ha-dp-minyear"),maxYear:this.getAttribute("data-ha-dp-maxyear"),resultInSolar:this.getAttribute("data-ha-dp-resultinsolar"),isSolar:this.getAttribute("data-ha-dp-issolar"),forceSetTime:this.getAttribute("data-ha-dp-forcesettime"),disableTime:this.getAttribute("data-ha-dp-disabletime")});t.show()})},String.prototype.toFaDigit=function(){return this.replace(/\d+/g,function(e){for(var t="",a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)+1728);return t})},HaDateTimePicker.init();